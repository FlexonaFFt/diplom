# Пояснение к ТЗ неформально

## 1) Общая картина

У платформы два больших модуля:

1. **Контест** — «онлайн-тренажёр + экзаменатор». Тут решают задачи по программированию, отправляют решения, получают автоматическую проверку, а система собирает данные (для будущего датасета и исследований).
    
2. **Курсы** — «учебник + тестирование с рекомендациями». Тут лежат лекции, квизы после лекций и стартовый «умный тест» (IRT), который подсказывает, какие темы лучше пройти именно вам.
    

Обе части объединены единым **веб-сервисом (FastAPI)**, **базой данных (PostgreSQL)**, **очередью фоновых задач (Celery + Redis)** и **изолированным исполнителем кода (judge в контейнере)**.

---

## 2) Как работает «Контест»: жизненный цикл посылки

### А. Преподаватель готовит задачу

- Пишет условие, загружает **тесты** (набор входных/выходных примеров).
    
- Настраивает лимиты (время, память) и режим (домашка/экзамен).
    
- Всё это хранится в БД и доступно студентам по расписанию.
    

### Б. Студент отправляет решение

- **Домашка:** можно вставлять код в редактор, можно загружать файлы.
    
- **Экзамен:** вставка из буфера **запрещена**, файлов загружать нельзя; включён таймер.
    

Система делает «быструю проверку» на входе: размер, запрещённые импорты, базовые ошибки формата.

### В. Judge проверяет код

- Код уходит в **изолированную «песочницу»** — небольшой контейнер без сети, с ограничениями по времени/памяти.
    
- Решение запускается на «публичных» и «скрытых» тестах.
    
- На каждый тест фиксируется вердикт и ресурсы (время/память).
    

**Вердикты** понятны и коротки:

- **OK** — всё верно,
    
- **WA** — неверный ответ,
    
- **TLE** — превысил лимит времени,
    
- **MLE** — превысил память,
    
- **RE** — ошибка во время выполнения,
    
- **CE** — код не скомпилировался/не собрался.
    

### Г. Результаты и логи

Студент видит статус, вердикт и понятные сообщения (например, на каком тесте упал). Преподаватель видит агрегированную статистику по группе: у кого где проблемы.

---

## 3) Домашка vs Экзамен

- **Домашка:** максимально свободный режим — можно вставлять код, прикладывать файлы, пересдавать.
    
- **Экзамен:** включается глобальный/помодульный **таймер**, **запрещается paste**, блокируется загрузка файлов; при истечении времени — автосдача. Система **аудирует события** (скорость ввода, попытки вставки), чтобы потом было видно, как выполнялась работа.
    

Важно: блокировка вставки — это **клиентская мера** (на фронтенде), а сервер **записывает события** и «умирает» по таймеру. Это честно и воспроизводимо.

---

## 4) Проверка на плагиат: как именно

Задача — **быстро и прозрачно** подсветить подозрительные совпадения (окончательное решение всегда за преподавателем).

Мы используем простые, но эффективные уровни:

1. **Идентичность**: у двух решений одинаковый «нормализованный» текст (убираются пробелы/комментарии), совпадают хэши — сигнал 100%.
    
2. **Похожесть по токенам**: разбиваем код на «слова» (токены), меряем схожесть (например, индекс Жаккара). Порог настраивается.
    
3. **Временные паттерны**: смотрим, не шли ли похожие решения волнами с минимальным лагом (подозрительные «цепочки»).
    

Результат — **отчёт**: пары/группы совпадений, уровень уверенности, «тепловая карта» времени отправок, выгрузка в CSV/JSON.

---

## 5) Сбор данных в датасет: что и зачем

Мы **сохраняем все посылки и метаданные** (кто, когда, какой вердикт, сколько памяти/времени, хэши, сколько раз редактировал, сколько раз пытался вставить и т. п.). Это ценно для:

- улучшения автоматической проверки,
    
- дальнейшие исследования по этой теме,
    
- построения моделей рекомендации и диагностики.
    

Перед внешним экспортом данные **псевдонимизируются** (ID пользователей заменяются на стабильные псевдонимы), а лишние персональные поля выкидываются. Экспорт — в удобные форматы (Parquet/CSV + JSON-мета) и **с версией схемы**, чтобы наборы были воспроизводимыми.

---

## 6) Как устроен модуль «Курсы»

### А. Каталог и лекции

Курс → разделы → лекции. У лекции — текст/видео/слайды, список источников и **квиз после лекции**. Домашка для закрепления уходит в модуль «Контест».

### Б. Стартовое «умное» тестирование (IRT)

Цель — **быстро понять пробелы** и предложить каждому оптимальный маршрут по темам.

- У каждого вопроса хранятся 3 параметра:
    
    - **a (различимость):** как хорошо вопрос отличает «знаю» от «не знаю».
        
    - **d (сложность):** на каком уровне знаний вопрос «в самый раз».
        
    - **c (угадывание):** вероятность угадать наугад (например, 0.25 для 4 вариантов).
        
- Модель вероятности правильного ответа:
    
    «Шанс ответить верно = c + (1 − c) / (1 + exp(−a(θ − d)))»,
    
    где **θ** — текущая «оценка знаний» студента по теме.
    
- **Байесовский апдейт:** после каждого ответа мы чуть-чуть двигаем θ вверх/вниз (в зависимости от ответа и параметров вопроса). Так постепенно формируется **вектор T** по темам: T1…Tn в диапазоне [0,1].
    

Итог: получаем **рекомендательный вектор** и список тем/лекций «к изучению в первую очередь». Перепройти стартовый тест можно позже — модель обновит рекомендации.

### В. Адаптация сложности

Если студент уверенно справляется с квизами и домахами по теме, система предлагает **более сложные лекции/вопросы**. Так каждый движется своим темпом.

---

## 7) Помощник внутри лекций (Q&A по материалам)

Это ограниченный «чат-помощник», который отвечает **только на основе материалов лекции**:

1. Лекция разбивается на маленькие фрагменты («карточки знания»).
    
2. На ваш вопрос ищутся **самые подходящие фрагменты** (поиск по смыслу).
    
3. Из них формируется ответ, с указанием источников внутри лекции.
    

Так ответы **точные и проверяемые**, без фантазий на внешние темы.

---

## 8) Архитектура и технологии: зачем именно они

- **FastAPI (async)** — быстрый, современный Python-фреймворк. Удобная документация API (Swagger).
    
- **PostgreSQL** — реляционная база для пользователей, задач, результатов, курсов.
    
- **Redis** — быстрая память для очередей и кэшей.
    
- **Celery** — фоновые воркеры, которые тянут тяжёлые задачи: проверка решений, формирование отчётов, экспорт датасетов.
    
- **Judge-контейнер** — запускает чужой код **в изоляции**: без сети, с жёсткими лимитами по CPU/памяти/времени.
    
- **MinIO/S3** (по мере надобности) — хранилище файлов (большие вложения, наборы тестов).
    
- **Frontend-редактор кода** (Monaco/CodeMirror) — удобный ввод, подсветка синтаксиса, автосохранение.
    

**Как компоненты «разговаривают»:**

1. Браузер → FastAPI: «Создай посылку с таким-то кодом».
    
2. FastAPI записывает запись в БД и ставит задачу в очередь Celery.
    
3. Воркеры Celery берут задачу, запускают код в judge-контейнере.
    
4. Результаты складываются в БД/хранилище, статус обновляется.
    
5. Браузер периодически спрашивает FastAPI о готовности таска и видит обновления.
    

---

## 9) Безопасность и честность

- **JWT-аутентификация** и роли (студент/преподаватель/админ).
    
- **Санитайзинг** входных данных, защита от XSS/CSRF на фронтенде.
    
- **Judge без сети**, с ограниченными правами.
    
- **Антикопипаст и аудит** в экзаменах: система честно фиксирует поведение.
    
- **Конфиденциальность**: при экспорте датасетов — псевдонимизация.
    

---

## 10) Тестирование и качество

- **pytest** — автоматические тесты: проверяем ключевые сценарии (регистрация, отправка решений, выдача вердиктов, таймеры, IRT-апдейт).
    
- **Покрытие тестами ≥ 70%** по «ядру» (проверка решений, расчёт вектора T).
    
- **CI** (GitHub Actions) — каждый пуш/PR прогоняет линтеры и тесты.
    

---

## 11) Масштабирование и надёжность

- Если пользователей больше — просто поднимаем **больше воркеров Celery** и несколько копий API.
    
- Есть **автоповторы** задач при сбоях, а критичные операции делаем **идемпотентными** (повторный запуск безопасен).
    
- Метрики (очереди, ошибки, вердикты) позволяют быстро увидеть узкие места.
    

---

## 12) Что оставим на доработку

- **Другие языки** программирования: подключаем новые «раннеры» (C++/Java и т. д.).
    
- **Продвинутый плагиат**: сравнение по AST, n-граммы.
  
- **Прокторинг**: камера, ограничения вкладок — отдельным модулем, без ломки ядра.
    
- **Граф тем**: красивая визуализация зависимостей знаний.
    

---

## 13) Расшифровка терминов и сокращений

- **Judge** — «песочница», где исполняется ваш код на тестах.
    
- **Вердикт** — итог по задаче (OK, WA, TLE, …).
    
- **IRT** — «умное тестирование»: вопросы с параметрами, которые помогают быстро оценить именно ваши знания.
    
- **Байесовский апдейт** — аккуратное «доверие» модели к новым ответам: правильно — поднимаем оценку, неправильно — снижаем, но без резких скачков.
    
- **Celery** — рабочие-«муравьи», выполняют тяжёлые фоновые задачи.
    
- **Псевдонимизация** — превращение реальных ID пользователей в стабильные, но обезличенные.
